<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

* {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}
html, body{
    margin: 0px;
    padding: 0px;
    height: 100%;
}
.body{
    background-image: url("wifi.jpeg");
    background-color:black;
    height: 100%;
    width: 100%;
    background-attachment: fixed;
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center center;
    margin-top: 0px;
    font-family: 'Lato', sans-serif;
}
.body .layer{
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    /*  To keep login form in center of the page    */
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
    -webkit-align-items: center;
    -ms-flex-align: center;
    align-items: center;
    -webkit-box-pack: center;
    -webkit-justify-content: center;
    -ms-flex-pack: center;
    justify-content: center;
}
.form{
	position: relative;
	margin: 20px 0px;
	width: 90%;
	max-width: 480px;
	text-align: center;
	background: rgb(4, 84, 243);
	padding: 43px 40px;
	border-radius: 8px;
}
.form .heading{
    color: #ffffff;
    font-size: 25px;
    margin: 0px 0 0px;
    height: 30px;
    line-height: 30px;
    text-align: center;
	font-weight: 700;
}
.form .signup-form{
    display: none;
}
.form .input{
    width: 100%;
    padding: 15px;
    background: #f8f8f8;
    border: 1px solid rgba(0, 0, 0, 0.075);
    margin-bottom: 25px;
    color: black !important;
    font-size: 13px;
    -webkit-transition: all 0.4s;
    -moz-transition: all 0.4s;
    -o-transition: all 0.4s;
    transition: all 0.4s;
    font-size: 17px;
    letter-spacing: 2px;
}
.form .input:focus{
    color:white;
    outline:none;
    border:1px solid #8BC3A3
}
button{
    width: 100%;
    padding: 0 20px;
    line-height: 50px;
    background: red;
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: 700;
    text-align: center;
    border: none;
    cursor: pointer;
    font-size: 17px;
	border-radius: 8px;
}
button:hover{
    background-color: #1a9dc9;
}
.form .input-box{
    margin-top: 40px;
}
.form .togglebtn {
    color: blue;
    background-color: transparent;
    border: none;
    outline: none;
    cursor: pointer;
    font-weight: 600;
}
::-webkit-input-placeholder{
    color:black;
    font-size:17px
}
:-moz-placeholder{
    color:black;
    font-size:17px
}
::-moz-placeholder{
    color:black;
    font-size:17px
}
:-ms-input-placeholder{
    color:black;
    font-size:17px
}

/* Hum Custom CSS */

#customers {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 280px;
  /*background: brown;
 //width: 300px; */
	align-content: center;
	 display: inline-block;
}

#customers td, #customers th {
  border: 1px solid #ddd;
  padding: 8px;
	width: 280px;
}

#customers tr:nth-child(even){background-color: red;}

#customers tr:hover {background-color: #0bc627;}

#customers th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #076d17;
  color: white;
	text-align: center;
}

td {
    color: white;
}

#marq{
    color: #ffffff;
}

</style>
<!-- Display the error message -->
<span id="oper-hint" style="color: red"></span>

<div id="hotspot-section">

    <select id="hotspot-selector"></select>
</div>
 <div class="body">
        <div class="layer">
            <div class="form">
                <div class="login-form">
                    <div class="input-box">
<form id="login-form">
    <!-- voucher code input box -->
    <div id="input-voucher">
        <input id="voucherCode" class="input" name="voucherCode" type="text" placeholder="Your Voucher Code" required/>
    </div>
	
	
    <!-- The username input box for Local User 、External RADIUS、 RADIUS -->
    <div id="input-user">
        <input id="username" name="username" type="text" placeholder="Username"/>
    </div>
    <!-- The password input box for Local User 、External RADIUS、 RADIUS -->
    <div id="input-password" class="user-input">
        <input id="password" name="password" type="password"  placeholder="Password"/>
    </div>
    <!-- The password input box for Simple password -->
    <div id="input-simple">
        <input id="simplePassword" name="simplePassword" type="password" placeholder="Password"/>
    </div>
    <!-- The drop-down box of country code and phone number input box for SMS -->
    <div id="input-phone-num">
        +<input id="country-code"><input id="phone-number" name="phone-number" type="text" placeholder="Phone Number"/>
    </div>
    <!-- The inputbox and button for SMS verification code -->
    <div id="input-verify-code">
        <input id="verify-code" name="verify-code" type="text" placeholder="Verification Code"/><button id="get-code">Get Code</button>
    </div>
</form>
</div>
	

<h2 class="heading"> FREE WiFi Access (5 Minutes) Everyday </h2>

<div id="button-area">
    <!-- The button for facebook. Click to open the interface of Facebook authentication -->
    <button id="button-facebook">Facebook</button>
    <!-- The login button for all authentication types except the Facebook authentication -->
    <!-- <button id="button-login">Log In</button> -->


	     <button id="button-login" type="submit" class="submit" >Access Free WiFi</button>
									
     <marquee id="marq">Welcome Aboard! You have Free 5 Minutes of Unlimited Access every day. To Upgrade your experience, please consider buying a Voucher Code at Corner Hour or your nearest Outlet</marquee>
</div>	<br><br>				
					
</div>
          <table id="customers" >
          <tbody>
            <tr>
              <th>Voucher</th>
              <th>Price</th>
            </tr>
            <tr>
              <td>12 Hours</td>
              <td>1,000/=</td>
            </tr>
            <tr>
              <td>24 Hours</td>
              <td>2,000/=</td>
            </tr>
            <tr>
              <td>7 Days</td>
              <td>7,000/=</td>
            </tr>
			  <tr>
              <td>30 Days</td>
              <td>30,000/=</td>
            </tr>
          </tbody>
        </table>
					<br><br>
                    <p id="marq"> If you experience any challenges, Please contact the Network Administrator at the STK Consults Mobile Money Shop for a <strong>FREE Refund Voucher!</strong></p>
                    <br>
				
				</div>
				</div>
			</div>

<script type="text/javascript">
    //This is the utility function. Please do not delete.
    var Ajax = {
        post: function (url, data, fn) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 304)) {
                    fn.call(this, xhr.responseText);
                }
            };
            xhr.send(data);
        }
    };
    //This is the utility function. Please do not delete.
    function getQueryStringKey (key) {
        return getQueryStringAsObject()[key];
    }
    //This is the utility function. Please do not delete.
    function getQueryStringAsObject () {
        var b, cv, e, k, ma, sk, v, r = {},
            d = function (v) { return decodeURIComponent(v); },
            q = window.location.search.substring(1),
            s = /([^&;=]+)=?([^&;]*)/g
        ;
        ma = function(v) {
            if (typeof v != "object") {
                cv = v;
                v = {};
                v.length = 0;
                if (cv) { Array.prototype.push.call(v, cv); }
            }
            return v;
        };
        while (e = s.exec(q)) {
            b = e[1].indexOf("[");
            v = d(e[2]);
            if (b < 0) {
                k = d(e[1]);
                if (r[k]) {
                    r[k] = ma(r[k]);
                    Array.prototype.push.call(r[k], v);
                }
                else {
                    r[k] = v;
                }
            }
            else {
                k = d(e[1].slice(0, b));
                sk = d(e[1].slice(b + 1, e[1].indexOf("]", b)));
                r[k] = ma(r[k]);
                if (sk) { r[k][sk] = v; }
                else { Array.prototype.push.call(r[k], v); }
            }
        }
        return r;
    }

    var data = {};
    var globalConfig = {};
    var submitUrl;
    var clientMac = getQueryStringKey("clientMac");
    var apMac = getQueryStringKey("apMac");
    var gatewayMac = getQueryStringKey("gatewayMac") || undefined;
    var ssidName = getQueryStringKey("ssidName") || undefined;
    var radioId = !!getQueryStringKey("radioId")? Number(getQueryStringKey("radioId")) : undefined;
    var vid = !!getQueryStringKey("vid")? Number(getQueryStringKey("vid")) : undefined;
    var originUrl = getQueryStringKey("originUrl");
    var previewSite = getQueryStringKey("previewSite");

    var hotspotMap = {
        3: "Voucher Access",
        5: "Local User Access",
        6: "SMS Access",
        8: "RADIUS Access"
    };
    //error code
    var errorHintMap = {
        "0": "ok",
        "-1": "General error.",
        "-41500": "Invalid authentication type.",
        "-41501": "Failed to authenticate.",
        "-41502": "Incorrect voucher code.",
        "-41503": "This voucher code is expired.",
        "-41504": "The traffic used by this voucher code has reached the limit.",
        "-41505": "The number of users has reached the limit.",
        "-41506": "Invalid authorization information.",
        "-41507": "Your authentication times out. You can get authenticated again until the next day.",
        "-41508": "The traffic used by this local user has reached the limit.",
        "-41512": "This local user is expired.",
        "-41513": "This local user is disabled.",
        "-41514": "Incorrect MAC address.",
        "-41516": "The number of users has reached the limit.",
        "-41517": "Incorrect password.",
        "-41518": "This SSID does not exist.",
        "-41519": "Invalid code.",
        "-41520": "The code is expired.",
        "-41521": "The number of users has reached the limit.",
        "-41522": "Failed to validate the code.",
        "-41523": "Failed to send verification code.",
        "-41524": "Authentication failed because the username does not exsit.",
        "-41525": "Authentication failed because of the wrong password.",
        "-41526": "Authentication failed because the client is invalid.",
        "-41527": "Authentication failed because the local user is invalid."
    };

    //The redirect address when customer select Facebook authentication
    var facebookUrl = !!apMac? ('/portal/fbwifi/forward?clientMac='+encodeURIComponent(clientMac)+'&apMac='+encodeURIComponent(apMac)+'&ssidName='+encodeURIComponent(ssidName)+'&radioId='+encodeURIComponent(radioId)+'&originUrl='+encodeURIComponent(originUrl))
        : ('/portal/fbwifi/forward?clientMac='+encodeURIComponent(clientMac)+'&gatewayMac='+encodeURIComponent(gatewayMac)+'&vid='+encodeURIComponent(vid)+'&originUrl='+encodeURIComponent(originUrl));

    var isCommited;

    Ajax.post(
        '/portal/getPortalPageSetting',
        JSON.stringify({
            "clientMac": clientMac,
            "apMac": apMac,
            "gatewayMac": gatewayMac,
            "ssidName": ssidName,
            "radioId": radioId,
            "vid": vid,
            "originUrl": originUrl
        }),
        function (res) {
            res = JSON.parse(res);
            data = res.result;
            submitUrl           = "/portal/auth";
            var landingUrl  = data.landingUrl;
            isCommited          = false;
            globalConfig = {
                authType: data.authType,
                hotspotTypes: !!data.hotspot && data.hotspot.enabledTypes || [],
                error         : data.error || 'ok',
                countryCode   : !!data.sms && data.sms.countryCode || 1
            };
            function pageConfigParse(){
                if (res.errorCode !== 0){
                    document.getElementById("oper-hint").style.display = "block";
                    document.getElementById("oper-hint").innerHTML = errorHintMap[res.errorCode];
                }
                //This is the initialized authentication interface. It will hide all authentication options at first. Determine the displayed interface according to the selected authentication type.
                document.getElementById("hotspot-section").style.display = "none";
                document.getElementById("input-voucher").style.display = "none";
                document.getElementById("input-user").style.display = "none";
                document.getElementById("input-password").style.display = "none";
                document.getElementById("input-simple").style.display = "none";
                document.getElementById("input-phone-num").style.display = "none";
                document.getElementById("input-verify-code").style.display = "none";
                document.getElementById("button-facebook").style.display = "none";
                switch (globalConfig.authType){
                    case 0://No Authentication: Login directly without any options.
                        window.authType = 0;
                        break;
                    case 1://Simple Password: Display the password input box.
                        document.getElementById("input-simple").style.display = "block";
                        window.authType = 1;
                        break;
                    case 2://External RADIUS Server: Display a username input box and password input box. 
                        hotspotChang(2);
                        window.authType = 2;
                        break;
                    case 7://Facebookacebook: Display a button for facebook authentication. 
                        document.getElementById("button-facebook").style.display = "block";
                        document.getElementById("button-facebook").addEventListener("click", function () {
                            window.location.href = facebookUrl;
                        });
                        document.getElementById("button-login").style.display = "none";
                        window.authType = 7;
                        break;
                    case 11:
                        // Hotspot: It can contain Voucher Access，Local User Access，SMS Access，RADIUS Access.
                        // There is s drop-down box to select the authentication method. 
                        var options = "";
                        for (var i=0;i<globalConfig.hotspotTypes.length;i++) {
                            options += '<option value="'+globalConfig.hotspotTypes[i]+'">'+hotspotMap[globalConfig.hotspotTypes[i]]+'</option>';
                        }
                        if (globalConfig.hotspotTypes.length > 1) {
                            document.getElementById("hotspot-section").style.display = "block";
                        }
                        document.getElementById("hotspot-selector").innerHTML = options;
                        hotspotChang(globalConfig.hotspotTypes[0]);
                        window.authType = globalConfig.hotspotTypes[0];
                        break;
                }
            }

            function handleSubmit(){
                var submitData = {};
                submitData['authType'] = window.authType;
                switch (window.authType){
                    case 3:
                        submitData['voucherCode'] = document.getElementById("voucherCode").value;
                        break;
                    case 5:
                        submitData['localuser'] = document.getElementById("username").value;
                        submitData['localuserPsw'] = document.getElementById("password").value;
                        break;
                    case 1:
                        submitData['simplePassword'] = document.getElementById("simplePassword").value;
                        break;
                    case 0:
                        break;
                    case 6:
                        submitData['phone'] = document.getElementById("country-code").value + document.getElementById("phone-number").value;
                        submitData['code'] = document.getElementById("verify-code").value;
                        break;
                    case 2:
                    case 8:
                        submitData['username'] = document.getElementById("username").value;
                        submitData['password'] = document.getElementById("password").value;
                        break;
                    default:
                        break;
                }

                if(isCommited == false){
                    submitData['clientMac'] = clientMac;
                    submitData['apMac'] = apMac;
                    submitData['gatewayMac'] = gatewayMac;
                    submitData['ssidName'] = ssidName;
                    submitData['radioId'] = radioId;
                    submitData['vid'] = vid;
                    if(window.authType == 2 || window.authType == 8){
                        submitUrl = "/portal/radius/auth";
                        submitData['authType'] = window.authType;
                    } else {
                        submitData['originUrl'] = originUrl;
                    }
                    function doAuth () {
                        Ajax.post(submitUrl, JSON.stringify(submitData).toString(), function(data){
                            data = JSON.parse(data);
                            if(!!data && data.errorCode === 0) {
                                isCommited = true;
                                window.location.href = landingUrl;
                                document.getElementById("oper-hint").innerHTML = errorHintMap[data.errorCode];
                            } else{
                                document.getElementById("oper-hint").innerHTML = errorHintMap[data.errorCode];
                            }
                        });
                    }
                    doAuth();
                }
            }
            function hotspotChang (type) {
                //The way to deal with Hotspot.It contains Voucher Access，Local User Access，SMS Access，RADIUS Access.
                //It will hide all hotspot authentication methods at first. Then determine the displayed interface according to the selected authentication method.
                document.getElementById("input-voucher").style.display = "none";
                document.getElementById("input-user").style.display = "none";
                document.getElementById("input-password").style.display = "none";
                document.getElementById("input-phone-num").style.display = "none";
                document.getElementById("input-verify-code").style.display = "none";
                document.getElementById("button-login").style.display = "block";
                window.authType = type;
                switch (Number(type)) {
                    case 3://voucher: Display a voucher code input box.
                        document.getElementById("input-voucher").style.display = "block";
                        break;
                    case 5://Local User
                    case 2://External RADIUS
                    case 8://RADIUS
                        //The above three methods will display username input box and password input box.
                        document.getElementById("input-user").style.display = "block";
                        document.getElementById("input-password").style.display = "block";
                        break;
                    case 6:
                        //SMS: Display a drop-down box for selecting country code, a phone number input box, a verification code input box, and a button to send authentication email.
                        //You need to input the phone number to get the authentication email containing the verification code then input the verification code.
                        document.getElementById("input-phone-num").style.display = "block";
                        document.getElementById("input-verify-code").style.display = "block";
                        break;
                }
            }
            globalConfig.countryCode = "+" + parseInt(globalConfig.countryCode, 10);
            document.getElementById("country-code").value = parseInt(globalConfig.countryCode, 10);
            document.getElementById("hotspot-selector").addEventListener("change", function () {
                var obj = document.getElementById("hotspot-selector");
                var opt = obj.options[obj.selectedIndex];
                hotspotChang(opt.value);
            });
            document.getElementById("button-login").addEventListener("click", handleSubmit);
            document.getElementById("get-code").addEventListener("click", function(e){
                e.preventDefault();
                var phoneNum = document.getElementById("phone-number").value;
                function sendSmsAuthCode () {
                    Ajax.post("/portal/sendSmsAuthCode",
                        JSON.stringify({
                            clientMac: clientMac,
                            apMac: apMac,
                            gatewayMac: gatewayMac,
                            ssidName: ssidName,
                            radioId: radioId,
                            vid: vid,
                            phone: "+" + document.getElementById("country-code").value + phoneNum
                        }),function(data){
                            data = JSON.parse(data);
                            if(data.errorCode !== 0){
                                document.getElementById("oper-hint").innerHTML = errorHintMap[data.errorCode];
                            } else {
                                document.getElementById("oper-hint").innerHTML = "SMS has been sent successfully.";
                            }
                        }
                    );
                }
                sendSmsAuthCode();
                document.getElementById("oper-hint").innerHTML = "Sending Authorization Code...";
            });
            pageConfigParse();
        }
    );
</script>


